define(["jquery","core/theme-app","core/modules/storage","core/theme-tpl-tags","theme/js/velocity.min","theme/js/transitions"],function(e,t,n,o,s,a){function i(){e("#menu-items").css("display","block"),e("#app-canvas").velocity({left:"85%"},300,function(){setTimeout(function(){r=!0},150)})}function c(n,o){r=!1,e("#app-canvas").velocity({left:"0"},300,function(){e("#menu-items").css("display","none"),1==n&&t.navigate(o.attr("href"))})}function l(){r?c():i()}function f(){e("#menu-button").removeClass("button-tap-off").addClass("button-tap-on")}function m(){return e("#menu-button").removeClass("button-tap-on").addClass("button-tap-off"),l(),!1}function u(){return r&&(e("#menu-items li").removeClass("menu-active-item"),e(this).closest("li").addClass("menu-active-item"),c(1,e(this))),!1}function d(){return r?c():t.navigate(e(this).attr("href")),!1}function p(t){e("#app-message-bar").html(t),e("#app-message-bar").removeClass("message-off").addClass("message-on"),setTimeout(h,3e3)}function h(){e("#app-message-bar").removeClass("message-on").addClass("message-off"),e("#app-message-bar").html("")}function v(){e("#refresh-button").removeClass("button-touch-off").addClass("button-touch-on")}function g(){t.isRefreshing()||(e("#refresh-button").removeClass("button-touch-on").addClass("button-touch-off"),e("#refresh-button").removeClass("refresh-off").addClass("refresh-on"),t.refresh())}function w(t){e("#content").scrollTop(t)}function y(){e(".single-template img").removeAttr("width height"),e(".single-template .wp-caption").removeAttr("style"),e(".single-template .wp-caption a").removeAttr("href")}function k(e){window.open(e.target.href,"_system","location=yes"),e.preventDefault()}t.on("refresh:start",function(){e("#refresh-button").removeClass("refresh-off").addClass("refresh-on")}),t.on("refresh:end",function(t){w(0),n.clear("scroll-pos"),e("#refresh-button").removeClass("refresh-on").addClass("refresh-off"),e("#menu-items li").removeClass("menu-active-item"),e("#menu-items li:first-child").addClass("menu-active-item"),p(t.ok?"Content updated successfully :)":t.message)}),t.on("error",function(e){p(e.message)}),t.on("screen:showed",function(t,o){if(r&&(e("#app-canvas").css("left","85%"),c()),("single"==t.screen_type||"page"==t.screen_type)&&(y(),e("#app-layout").on("click",".single-template a",k)),"list"==t.screen_type){var s=n.get("scroll-pos",t.fragment);null!==s?e("#content").scrollTop(s):w()}else w()}),t.on("screen:leave",function(t,o,s){"list"==t.screen_type&&n.set("scroll-pos",t.fragment,e("#content").scrollTop())});var r=!1;e("#app-layout").on("touchstart","#menu-button",f),e("#app-layout").on("touchend","#menu-button",m),e("#app-layout").on("touchstart","#refresh-button",v),e("#app-layout").on("touchend","#refresh-button",g),e("#app-layout").on("click","#menu-items li a",u),e("#app-layout").on("click","#content .content-item a",d),t.setAutoScreenTransitions(a.replace,a.slideLeft,a.slideRight)});